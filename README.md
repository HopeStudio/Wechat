# 第一章 前期准备
## 简介
#### 第一章主要内容：
1. 了解微信号的种类特点
2. 本地代理环境的搭建以及最入门的加密认证

#### 学习建议：
1. 域名服务器环境配置与利用QQ浏览器代理调试端口结合看
2. 加密认证逻辑容易出错，耐心多看几遍

## 微信号分类和功能 
#### 基本分类
* 企业号：为企业或组织提供移动应用入口，帮助企业建立与员工、上下游供应链及企业应用建的联系
* 订阅号：比较适合于个人、小团队，主要是用于信息传播，帮助管理用户以及和用户互动，比如:撰写文章、咨询传播、消息定制等等
* 
服务号：为企业和组织提供更强大的业务服务于用户管理能力，比如：支付、智能接口等

#### 认证与非认证
公众号分为认证与非认证，认证的比非认证的能做更多事情      
认证一般需要你有一个开户过的企业        
订阅号认证与非认证的区别就是，认证账号别人可以直接在添加好友里搜索关键词找到你
订阅号与服务号的三点不同：
1. 出现位置不同
2. 单月发送消息数量不同，订阅号可以一天1篇，服务号一个月最多4篇
3. 订阅号没有9大接口和支付功能
#### 服务号9大接口
1. 语音识别：识别语音，并翻译成文本
2. 客服接口：公众号可以在你发送过消息的24小时内，向你回复消息
3. OAuth 2.0网页授权：可以通过授权接口，请求用户授权，从而拿到更多用户的信息
4. 生成带参数的二维码：公众号可以获得一系列携带不同参数的二维码，在用户扫描关注公众号后，公众号可以根据参数分析各二维码的效果，这些参数可以定制，从而可以实现更多分析结果，比如用户从哪来的
5. 获取用户地理位置：公众号能够获得用户进入公众号会话时的地理位置，可以做微信导航
6. 获取用户基本信息：公众号可以根据加密后的用户OpenID，通过一系列的参数交互，最终拿到用户基础信息，包括头像、名称、性别、地区
7. 获取关注着列表：可以拿到所有关注者的OpenID，知道多少人关注你，或者是谁在关注你
8. 用户分组接口：在后台为用户移动、创建、修改分组
9. 上传下载多媒体文件：需要时在微信服务器上上传下载多媒体文件
#### 订阅号接口
1. 会话界面的自定义菜单
2. 多客服接口，提供贴心快捷的客服服务
3. 获取用户地理位置，精确提供服务
4. 高级群发接口，实现更灵活的群发能力
5. 用户分组接口，方便管理用户

## 域名、服务器及ngrok环境配置 
把内网端口暴露到公网
http://www.ultrahook.com/faq
gem install ultrahook
ultrahook --k hl8sQ1i24bQEIGrhDqexBbQ7lUtVtPO7 localhost 1234

npm install -g localtunnel
lt --port 1234


## 配置、接入微信公众号
#### 申请微信公众号
#### 配置微信公众号后台
#### 验证公众号
配置完成微信公众号后，点击提交微信服务器会发送GET请求将token,timestamp,nonce三个参数传至本地服务器
```
{ signature: 'df737dc55a7bc612a114b5e4a6052134c8060a3f',
  echostr: '4469749067976388605',
  timestamp: '1465461613',
  nonce: '82235853' }
```
1. 将token、timestamp、nonce三个参数进行字典序排序
    [token,timestamp,nonce].sort().join('');
2. 将三个参数字符串拼接成一个字符串进行sha1加密
3. 将加密后的字符串与signature对比，如果相同，表示这个请求来自微信，我们直接原样返回echostr参数内容，接入验证就成功了
```
app.use(function*(next) {
    var signature = this.query.signature,
        echostr = this.query.echostr,
        timestamp = this.query.timestamp,
        nonce = this.query.nonce,
        token = config.wechat.token;
    var str = [token, timestamp, nonce].sort().join('');
    if (sha1(str) === signature)
        return this.body = echostr + '';
    else
        return this.body = 'error';
})
```
## 写段代码实现加密认证逻辑
 #### 为什么使用koa框架？
 代码可以更精简、更易懂、对于反反复复的异步交互更适用这个框架实现


## 利用koa实现一个回声服务器